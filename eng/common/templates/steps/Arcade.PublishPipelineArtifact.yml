parameters:
- name: displayName
  type: string
  default: 'Publishing Pipeline Artifacts'

- name: target
  type: string
  default: 'container: host'

- name: mainCondition
  type: string
  default: ''

- name: artifactName
  type: string

- name: targetPath
  type: string

- name: properties
  type: string
  default: ''

- name: continueOnError
  type: boolean
  default: false

- name: runAsInternal
  default: False
  type: boolean

- name: publishLocation
  default: 'pipeline'
  type: string

- name: PathtoPublish
  default: ''
  type: string

steps:
- ${{ if parameters.runAsInternal }}:
  - task: 1ES.PublishPipelineArtifact@1
    displayName: ${{ parameters.displayName }}
    target: 
      container: host
    condition: ${{ coalesce( parameters.mainCondition, 'succeeded()') }}
    ${{ if eq(parameters.continueOnError, true) }}:
      continueOnError: ${{ coalesce(parameters.continueOnError, '') }}
    inputs:
      publishLocation: ${{ parameters.publishLocation }}
      artifactName: ${{ parameters.artifactName }}
      targetPath: '${{ parameters.targetPath }}'
      ${{ if ne(parameters.properties, '') }}:
        properties: ${{ parameters.properties }}
- ${{ if not(parameters.runAsInternal) }}:
  - task: PublishBuildArtifacts@1
    displayName: ${{ parameters.displayName }}
    condition: ${{ coalesce( parameters.mainCondition, 'succeeded()') }}
    ${{ if eq(parameters.continueOnError, true) }}:
      continueOnError: ${{ coalesce(parameters.continueOnError, '') }}
    inputs:
      artifactName: ${{ parameters.artifactName }}
      publishLocation: ${{ parameters.publishLocation }}
      ${{ if ne(parameters.targetPath, '') }}:
        PathToPublish: ${{ parameters.targetPath }}
      ${{ if eq(parameters.targetPath, '') }}:
        PathToPublish: $(Build.ArtifactStagingDirectory)

