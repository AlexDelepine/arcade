<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Task Packages </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Task Packages ">
      
      <link rel="icon" href="../../../favicon.ico">
      <link rel="stylesheet" href="../../../public/docfx.min.css">
      <link rel="stylesheet" href="../../../public/main.css">
      <meta name="docfx:navrel" content="">
      <meta name="docfx:tocrel" content="">
      
      
      
      
      
  </head>

  <script type="module">
    import options from './../../../public/main.js'
    import { init } from './../../../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../../index.html">
            <img id="logo" class="svg" src="../../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="task-packages">Task Packages</h1>

<p>Task packages provides a set of commonly used MSBuild tasks that are not included in MSBuild itself.</p>
<h2 id="tasks">Tasks</h2>
<p>Each task package must be self-contained in that it cannot define dependencies on other task packages (see <a href="#no-dependencies">below</a>.)
Task packages should avoid grouping too many tasks into the same place.</p>
<h3 id="reducing-duplicate-effort">Reducing duplicate effort</h3>
<p>One reason to put tasks into shared packages is to reduce duplication in infrastructure code.
We currently have multiple implementations of similar tasks in use by .NET Core and ASP.NET Core projects.
Each is maintaining their own version.</p>
<p>Examples:</p>
<ul>
<li><a href="https://github.com/dotnet/cli/blob/master/build/Microsoft.DotNet.Cli.tasks">https://github.com/dotnet/cli/blob/master/build/Microsoft.DotNet.Cli.tasks</a></li>
<li><a href="https://github.com/aspnet/BuildTools/tree/dev/modules/KoreBuild.Tasks">https://github.com/aspnet/BuildTools/tree/dev/modules/KoreBuild.Tasks</a></li>
<li><a href="https://github.com/dotnet/buildtools/tree/master/src/Microsoft.DotNet.Build.Tasks">https://github.com/dotnet/buildtools/tree/master/src/Microsoft.DotNet.Build.Tasks</a></li>
<li><a href="https://github.com/dotnet/core-setup/tree/master/tools-local/tasks">https://github.com/dotnet/core-setup/tree/master/tools-local/tasks</a></li>
</ul>
<p>Some of these tasks of nearly identical behavior but just use different names. Some examples:</p>
<ul>
<li><code>GenerateFileFromTemplate</code> / <code>ReplaceFileContents</code> / <code>PreprocessFile</code></li>
<li><code>SetEnvVar</code> / <code>SetEnvironmentVariable</code></li>
<li><code>UnzipArchive</code> / <code>ZipFileExtractToDirectory</code></li>
</ul>
<h2 id="usage">Usage</h2>
<p>Tasks packages are distributed as a NuGet package using existing NuGet mechanisms. Developers can use them in MSBuild projects in the following ways:</p>
<h3 id="sdk-element-recommended">Sdk element (recommended)</h3>
<p>Reference the package as an &quot;SDK&quot; in your MSBuild project. MSBuild 15.6 and up will automatically restore and extract this package.</p>
<pre><code class="lang-xml">&lt;Project&gt;
    &lt;Sdk Name=&quot;Microsoft.DotNet.Build.Tasks.IO&quot;/&gt;

    &lt;Target Name=&quot;CustomStep&quot;&gt;
        &lt;DownloadFile Url=&quot;$(DownloadUri)&quot; OutputPath=&quot;$(DownloadOutput)&quot; /&gt;
    &lt;/Target&gt;
&lt;/Packages&gt;
</code></pre>
<pre><code class="lang-js">// global.json
{
   &quot;msbuild-sdks&quot;: {
      &quot;Microsoft.DotNet.Build.Tasks.IO&quot;: &quot;1.0.0&quot;
   }
}
</code></pre>
<p><strong>Best practice</strong>: although SDK versions can be specified in .proj files, it is recommended to use global.json to ensure the SDK version
is consistent within a solution.</p>
<h3 id="packagereference-pre-msbuild-156">PackageReference (pre MSBuild 15.6)</h3>
<p>Reference the project as a PackageReference in csproj files. It is strongly recommended to set <code>PrivateAssets=&quot;All&quot;</code> to avoid this package ending up in generated nuspec files.</p>
<pre><code class="lang-xml">&lt;Project Sdk=&quot;Microsoft.NET.Sdk&quot;&gt;
    &lt;ItemGroup&gt;
        &lt;PackageReference id=&quot;Microsoft.DotNet.Build.Tasks.IO&quot; Version=&quot;1.0.0&quot; PrivateAssets=&quot;All&quot; /&gt;
    &lt;/ItemGroup&gt;

    &lt;Target Name=&quot;CustomStep&quot;&gt;
        &lt;DownloadFile Url=&quot;$(DownloadUri)&quot; OutputPath=&quot;$(DownloadOutput)&quot; /&gt;
    &lt;/Target&gt;
&lt;/Packages&gt;
</code></pre>
<h3 id="packagesconfig-nuget-2msbuild-14">packages.config (NuGet 2/MSBuild 14)</h3>
<p>Use <code>NuGet.exe install packages.config</code> to download the package</p>
<pre><code class="lang-xml">&lt;packages&gt;
    &lt;package id=&quot;Microsoft.DotNet.Build.Tasks.IO&quot; version=&quot;1.0.0&quot; /&gt;
&lt;/packages&gt;
</code></pre>
<p>From your MSBuild project, import <code>Sdk.props</code> and <code>Sdk.targets</code> from the extract package location.</p>
<pre><code class="lang-xml">&lt;Project ToolsVersion=&quot;14.0&quot; xmlns=&quot;http://schemas.microsoft.com/developer/msbuild/2003&quot;&gt;
    &lt;Import Project=&quot;packages/Microsoft.DotNet.Build.Tasks.IO/1.0.0/Sdk/Sdk.props&quot; /&gt;

    &lt;Target Name=&quot;CustomStep&quot;&gt;
        &lt;DownloadFile Url=&quot;$(DownloadUri)&quot; OutputPath=&quot;$(DownloadOutput)&quot; /&gt;
    &lt;/Target&gt;

    &lt;Import Project=&quot;packages/Microsoft.DotNet.Build.Tasks.IO/1.0.0/Sdk/Sdk.targets&quot; /&gt;
&lt;/Project&gt;
</code></pre>
<h2 id="implementation-details">Implementation details</h2>
<p>Task packages have this layout</p>
<pre><code>(root)
  - sdk/
     + Sdk.props
     + Sdk.targets
  - build/
    + $packageId.props
    + $packageId.targets
    - netstandard1.5/
        + $taskAssembly.dll
    - net46/
        + $taskAssembly.dll
</code></pre>
<p>Packages have the following metadata in their nuspec.</p>
<pre><code class="lang-xml">&lt;packageTypes&gt;
    &lt;packageType name=&quot;MSBuildSdk&quot; /&gt;
&lt;/packageTypes&gt;
</code></pre>
<h3 id="no-dependencies">No dependencies</h3>
<p>MSBuild task packages cannot have dependencies (due to the current design of the NuGet SDK resolver: <a href="https://github.com/Microsoft/msbuild/issues/2803">https://github.com/Microsoft/msbuild/issues/2803</a>).</p>
<pre><code class="lang-xml">&lt;package&gt;
  &lt;metadata&gt;
    &lt;dependencies&gt;
        &lt;!-- Must be empty --&gt;
    &lt;/dependencies&gt;
  &lt;/metadata&gt;
&lt;/package&gt;
</code></pre>
<h3 id="examples">Examples</h3>
<p>The following are examples of tasks that we would like to build into common shared packages.
The implementation and naming is still subject to further review.
This list contains a set of tasks that appear to be commonly used across several repos.</p>
<p>Microsoft.DotNet.Build.Tasks.IO</p>
<ul>
<li><code>DownloadFile</code> - downloads a file.</li>
<li><code>ZipArchive</code> - creates a .zip file</li>
<li><code>UnzipArchive</code> - unzips a .zip file</li>
<li><code>GenerateFileFromTemplate</code> - supports a very simple templating format for key/value substitutions in a file</li>
<li><code>ComputeChecksum</code> - computes the SHA256 or SHA512 checksum for files</li>
<li><code>Chmod</code> - change Unix permissions</li>
</ul>
<p>Microsoft.DotNet.Build.Tasks.Git</p>
<ul>
<li><code>GetGitCommitHash</code> - reads the current commit hash from a .git folder without needing git.exe installed</li>
<li><code>GetGitCommitBranch</code> - reads the current brancn name</li>
</ul>
<p>Microsoft.DotNet.Build.Tasks.Shell</p>
<ul>
<li><code>Run</code> - like <code>Exec</code>, but it handles the complexity of escaping quotes and spaces in arguments</li>
<li><code>RunDotNet</code> - like <code>Run</code>, but launches a process using the same <code>dotnet.exe</code> file used to launch the current MSBuild process. Espcially useful for longing .NET Core console build tools</li>
<li><code>FindDotNetPath</code> - finds the <code>dotnet.exe</code> path on a machine</li>
<li><code>SetEnvironmentVariable</code> - sets an environment variable</li>
</ul>
<p>Microsoft.DotNet.Build.Tasks.NuGet</p>
<ul>
<li><code>PackNuspec</code> - packages a .nuspec file</li>
<li><code>DownloadNuGetPackage</code> - fetches a package from a NuGet feed</li>
<li><code>PushNuGetPackages</code> - pushes NuGet packages in parallel</li>
<li><code>ReadNuGetPackageIdentity</code> - opens a .nupkg file and reads the package ID and version from its metadata</li>
</ul>
<p>Microsoft.DotNet.Build.Tasks.AzureStorage</p>
<ul>
<li><code>UploadBlobToAzure</code> - pushes a blob to Azure Storage account</li>
</ul>
<h3 id="packages-by-team-which-should-be-shared-to-start">Packages (by team) which should be shared to start</h3>
<p><strong>ASP</strong></p>
<ul>
<li>Tasks
<ul>
<li>DownloadFile</li>
<li>ZipArchive</li>
<li>UnzipArchive</li>
<li>GenerateFileFromTemplate</li>
<li>ComputeChecksum</li>
<li>Chmod</li>
</ul>
</li>
</ul>
<p><strong>Roslyn/CLI</strong></p>
<ul>
<li>Repack</li>
<li>Signtool</li>
</ul>
<p><strong>CoreFx/CoreCLR</strong></p>
<ul>
<li>BlobFeed
<ul>
<li>VersionTools/Dependency update</li>
<li>Repo Tools</li>
<li>ILAsm</li>
</ul>
</li>
<li>ILLinker</li>
</ul>
<!-- Begin Generated Content: Doc Feedback -->
<p><sub>Was this helpful? <a href="https://helix.dot.net/f/p/5?p=Documentation%5CProject-Docs%5CToolset%5CTaskPackages.md"><img src="https://helix.dot.net/f/ip/5?p=Documentation%5CProject-Docs%5CToolset%5CTaskPackages.md" alt="Yes"></a> <a href="https://helix.dot.net/f/n/5?p=Documentation%5CProject-Docs%5CToolset%5CTaskPackages.md"><img src="https://helix.dot.net/f/in" alt="No"></a></sub></p>
<!-- End Generated Content-->
</article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>