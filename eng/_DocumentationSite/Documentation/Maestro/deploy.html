<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
      <title>Maestro deployment </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Maestro deployment ">
      
      <link rel="icon" href="../../favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="">
      <meta name="docfx:tocrel" content="">
      
      
      
      
      
  </head>

  <script type="module">
    import options from './../../public/main.js'
    import { init } from './../../public/docfx.min.js'
    init(options)
  </script>

  <script>
    const theme = localStorage.getItem('theme') || 'auto'
    document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
  </script>


  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../logo.svg" alt="">
            
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">
      <div class="toc-offcanvas">
        <div class="offcanvas-md offcanvas-start" tabindex="-1" id="tocOffcanvas" aria-labelledby="tocOffcanvasLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="tocOffcanvasLabel">Table of Contents</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#tocOffcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <nav class="toc" id="toc"></nav>
          </div>
        </div>
      </div>

      <div class="content">
        <div class="actionbar">
          <button class="btn btn-lg border-0 d-md-none" style="margin-top: -.65em; margin-left: -.8em" type="button" data-bs-toggle="offcanvas" data-bs-target="#tocOffcanvas" aria-controls="tocOffcanvas" aria-expanded="false" aria-label="Show table of contents">
            <i class="bi bi-list"></i>
          </button>

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="maestro-deployment">Maestro deployment</h1>

<p>The Maestro web application is deployed at <a href="http://maestro-prod.azurewebsites.net">http://maestro-prod.azurewebsites.net</a>.  It is currently published in the <a href="https://ms.portal.azure.com/#resource/subscriptions/68672ab8-de0c-40f1-8d1b-ffb20bd62c0f/resourcegroups/maestro/providers/Microsoft.Web/sites/maestro-prod/appServices">maestro-prod app service</a> in the 'Helix' Azure subscription.</p>
<h2 id="logs">Logs</h2>
<p>The logs are in the <a href="https://ms.portal.azure.com/#resource/subscriptions/68672ab8-de0c-40f1-8d1b-ffb20bd62c0f/resourceGroups/maestro/providers/Microsoft.Storage/storageAccounts/maestroprodstorage/overview">maestroprodstorage Storage Account</a>.  The CSV files can be viewed by opening the maestro-logs blob container in Azure or your favorite blob storage viewer (e.g. Cloud Explorer in VS or Storage Explorer).</p>
<h2 id="source-code-change-publish">Source code change: Publish</h2>
<p>Whenever a change to the Maestro source code is submitted, the app needs to be published.  This is currently a manual process.</p>
<ol>
<li>Ensure that the local dotnet/versions tree is in sync with the master branch on GitHub.</li>
<li>Open Maestro\Microsoft.DotNet.Maestro.sln in VS.</li>
<li>Remove the &quot;AzureWebJobsStorage&quot; connection string from Web.config.  (This connection string is not needed in Web.config when publishing because it is defined in App Settings in Azure, but it's defined with an empty value in Web.config in source control so that it can be easily set when F5'ing.)</li>
<li>Build the solution.</li>
<li>Right-click on the Microsoft.DotNet.Maestro.WebApi project, and select Publish.</li>
<li>Select “Microsoft Azure App Service”.</li>
<li>Select the “maestro-prod” app service in the 'Helix' subscription and click OK.</li>
<li>On the Settings page of the publish wizard, select the Release configuration.</li>
<li>Click Publish.</li>
<li>Right-click on the Microsoft.DotNet.Maestro.WebJob project, and select Publish as Azure WebJob.
<ul>
<li>Note: You need the Azure Development workload installed in VS2017.</li>
</ul>
</li>
<li>Repeat steps 5-8.</li>
<li>Locally undo the removal of the connection string in Web.config, and the adding of the publish profiles to the csprojs.</li>
</ol>
<h2 id="monitoring-logs">Monitoring logs</h2>
<p>Please check in the logs to validate if requests are still flowing:</p>
<ol>
<li>Open the <a href="#logs">logs</a>.</li>
<li>Navigate to the latest date/hour (e.g. <code>maestro-prod/2017/08/31/22</code>).</li>
<li>Download and open <code>*applicationLog.csv</code>.</li>
<li>Make sure there are lines like <code>CommitPushed Complete</code> and <code>Successfully queued VSO build.</code>
<ul>
<li>You may need to wait until a build-info commit happens on <a href="https://github.com/dotnet/versions/tree/master/build-info">https://github.com/dotnet/versions/tree/master/build-info</a>.</li>
</ul>
</li>
</ol>
<h2 id="confirming-on-azure-that-the-publish-worked">Confirming on Azure that the publish worked</h2>
<p><em>Note:</em> This is a diagnosis step if you're not sure the publish worked. It's not a required publish step.</p>
<ol>
<li>Go to the App Service Editor (preview).</li>
<li>Download <code>bin/Microsoft.DotNet.Maestro.dll</code> and <code>bin/Microsoft.DotNet.Maestro.WebApi.dll</code></li>
<li>Use ildasm, ILSpy, or some other disassembler to determine if the IL matches the changes you expected.</li>
</ol>
<!-- Begin Generated Content: Doc Feedback -->
<p><sub>Was this helpful? <a href="https://helix.dot.net/f/p/5?p=Documentation%5CMaestro%5Cdeploy.md"><img src="https://helix.dot.net/f/ip/5?p=Documentation%5CMaestro%5Cdeploy.md" alt="Yes"></a> <a href="https://helix.dot.net/f/n/5?p=Documentation%5CMaestro%5Cdeploy.md"><img src="https://helix.dot.net/f/in" alt="No"></a></sub></p>
<!-- End Generated Content-->
</article>

        <div class="contribution d-print-none">
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>
        
      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>


    <footer class="border-top">
      <div class="container-xxl">
        <div class="flex-fill">
          <span>Made with <a href="https://dotnet.github.io/docfx">docfx</a></span>
        </div>
      </div>
    </footer>
  </body>
</html>